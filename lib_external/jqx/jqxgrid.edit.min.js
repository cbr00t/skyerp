!function(T){T.extend(T.jqx._jqxGrid.prototype,{_handledblclick:function(e,t){if(null!=e.target&&!(t.disabled||T(e.target).ischildof(this.columnsheader)||(e.which?i=3==e.which:e.button&&(i=2==e.button),i||(e.which?l=2==e.which:e.button&&(l=1==e.button),l)))){var i=this.showheader?this.columnsheader.height()+2:0,l=this._groupsheader()?this.groupsheader.height():0,o=(l=l+(this.showtoolbar?this.toolbarheight:0)+(this.showfilterbar?this.toolbarheight:0),this.host.offset()),s=e.pageX-o.left,i=e.pageY-i-o.top-l,o=this._hittestrow(s,i);if(o){var i=o.row,o=o.index,d=e.target.className,a=this.table[0].rows[o];if(null!=a){t.mousecaptured=!0,t.mousecaptureposition={left:e.pageX,top:e.pageY-l};for(var r=this.hScrollInstance.value,n=0,c=(this.groupable&&this.groups.length,0);c<a.cells.length;c++){var h=parseInt(T(this.columnsrow[0].cells[c]).css("left")),u=h-r,p=(t.columns.records[c].pinned&&(u=h),this._getcolumnat(c));if(null==p||!p.hidden)if(s<=u+T(this.columnsrow[0].cells[c]).width()&&u<=s){n=c;break}}null!=i&&(p=this._getcolumnat(n),-1==d.indexOf("jqx-grid-group-expand")&&-1==d.indexOf("jqx-grid-group-collapse")&&-1!=i.boundindex&&t.begincelledit(t.getboundindex(i),p.datafield,p.defaulteditorvalue))}}}},_getpreveditablecolumn:function(e){for(;0<e;){e--;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_getnexteditablecolumn:function(e){for(;e<this.columns.records.length;){e++;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_handleeditkeydown:function(e,t){if(t.handlekeyboardnavigation&&1==t.handlekeyboardnavigation(e))return!0;var i,l,o,s=e.charCode||e.keyCode||0;if(t.editEvent=e,t.showfilterrow&&t.filterable&&this.filterrow&&T(e.target).ischildof(this.filterrow))return!0;if(t.showfilterbar&&t.filterable&&this.filterbar&&T(e.target).ischildof(this.filterbar))return!0;if(e.target.className&&0<=e.target.className.indexOf("jqx-grid-widget"))return!0;if(t.pageable&&T(e.target).ischildof(this.pager))return!0;if(this.showtoolbar&&T(e.target).ischildof(this.toolbar))return!0;if(this.showeverpresentrow){if(this.addnewrowtop&&T(e.target).ischildof(this.addnewrowtop))return!0;if(this.addnewrowbottom&&T(e.target).ischildof(this.addnewrowbottom))return!0}if(this.showstatusbar&&T(e.target).ischildof(this.statusbar))return!0;if(this.rowdetails&&T(e.target).ischildof(this.content.find("[role='rowgroup']")))return!0;if(this.editcell){if("selectedrow"===this.editmode){if(13===s)return this.endrowedit(this.editcell.row,!1),!1;if(27===s)return this.endrowedit(this.editcell.row,!0),!1;if(32==s)if(this._currentColumn&&"checkbox"==this.getcolumn(this._currentColumn).columntype)if((r=this.getcolumn(this._currentColumn)).editable)return n=!this.getcellvalue(this.editcell.row,r.datafield),c=this.getrowdata(this.editcell.row),i=this.editcell.row,c=t.getrowdata(t.editcell.row),this.pushToHistory=!0,this.setcellvalue(this.editcell.row,r.datafield,n,!1),this.pushToHistory=!1,m=this._focusedColumn,a=this._currentColumn,p=this._currentEditableColumn,this.endrowedit(this.editcell.row,!1),this.beginrowedit(i,!1),this._currentColumn=a,this._focusedColumn=m,this._currentEditableColumn=p,this._renderrows(),this.selectcell(i,r.datafield),this._oldselectedcell=this.selectedcell,m&&(l=this,setTimeout(function(){l.selectcell(i,r.datafield),l._oldselectedcell=l.selectedcell,T(l._checkboxCells[r.datafield].checkbox).jqxCheckBox("focus")},25)),!1;if(9!==s)return!0;var d=this.editcell.datafield,a=this._getcolumnindex(d),r=(this._currentEditableColumn?a=this._currentEditableColumn:this._currentEditableColumn=a,this._getnexteditablecolumn(a));if(r=e.shiftKey||this.rtl?this._getpreveditablecolumn(a):r){var a=this._getcolumnindex(r.datafield);if(this.editcell[r.datafield])this._currentEditableColumn=a,(u=this.editcell[r.datafield].editor)&&(u.data().jqxWidget&&u.data().jqxWidget.focus?u.data().jqxWidget.focus():(u.focus(),u[0].onkeyup=function(){0!=t.gridcontent[0].scrollTop&&(t.scrolltop(Math.abs(t.gridcontent[0].scrollTop)),t.gridcontent[0].scrollTop=0),0!=t.gridcontent[0].scrollLeft&&(t.gridcontent[0].scrollLeft=0)})),this._focusedColumn=r.datafield,this._currentColumn=r.datafield,0!=this.gridcontent[0].scrollTop&&(this.scrolltop(Math.abs(this.gridcontent[0].scrollTop)),this.gridcontent[0].scrollTop=0),0!=this.gridcontent[0].scrollLeft&&(this.gridcontent[0].scrollLeft=0);else if("checkbox"==r.columntype)return this._currentColumn=r.datafield,this._currentEditableColumn=a,this.selectcell(this.editcell.row,r.datafield),this._oldselectedcell=this.selectedcell,this._checkboxCells[r.datafield]&&T(this._checkboxCells[r.datafield].checkbox).jqxCheckBox("focus"),!1}return!1}if(null==this.editcell.columntype||"textbox"==this.editcell.columntype||"numberinput"==this.editcell.columntype||"combobox"==this.editcell.columntype||"datetimeinput"==this.editcell.columntype?33<=s&&s<=40&&"multiplecellsadvanced"==t.selectionmode&&(u="textbox"==this.editcell.columntype||null==this.editcell.columntype?this.editcell.editor:this.editcell.editor.find("input"),p=t._selection(u),m=u.val().length,0<p.length&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),0<p.start&&37==s&&(t._cancelkeydown=!0),p.start<m&&39==s&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),"datetimeinput"==this.editcell.columntype&&39==s&&p.start+p.length<m&&(t._cancelkeydown=!0)):"dropdownlist"==this.editcell.columntype?(37==s||39==s&&"multiplecellsadvanced"==t.selectionmode)&&(t._cancelkeydown=!1):"multiplecellsadvanced"==this.selectionmode&&"textbox"!=this.editcell.columntype&&"numberinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),32==s)if("checkbox"==t.editcell.columntype)if((r=t.getcolumn(t.editcell.datafield)).editable){var n=!t.getcellvalue(t.editcell.row,t.editcell.column);if(r.cellbeginedit)if(0==r.cellbeginedit(t.editcell.row,r.datafield,r.columntype,!n))return!1;var c=t.getrowdata(t.editcell.row);return t.pushToHistory=!0,t.setcellvalue(t.editcell.row,t.editcell.column,n,!0),t.pushToHistory=!1,t._raiseEvent(18,{rowindex:t.editcell.row,row:c,datafield:t.editcell.column,oldvalue:!n,value:n,columntype:"checkbox"}),!1}if(9==s){var h=this.editcell.row,u=d=this.editcell.column,a=t._getcolumnindex(d),p=!1,f=t.getrowvisibleindex(h),m=h,x=(this.editchar="",this.editcell.validated);if(0!=(x=this.editcell.validated?x:this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1))){if(e.shiftKey||this.rtl?(r=t._getpreveditablecolumn(a))?(d=r.datafield,p=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectprevcell(h,u),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,d)},10))):(x=t._getlastvisiblecolumn(),p=!0,d=x.displayfield,(w=t.getdisplayrows()[f-1])&&(void 0===(h=w.dataindex)&&(h=w.boundindex),f=t.getrowvisibleindex(h)),g=!0,t.pageable&&(v=Math.floor(f/this.pagesize),this.dataview.pagenum!=v&&(g=!1)),g&&-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(h,d),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,d)},10))):(r=t._getnexteditablecolumn(a))?(d=r.datafield,p=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectnextcell(h,u),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,d)},10))):(x=t._getfirstvisiblecolumn(),p=!0,d=x.displayfield,(w=t.getdisplayrows()[f+1])&&(void 0===(h=w.dataindex)&&(h=w.boundindex),f=t.getrowvisibleindex(h)),g=!0,t.pageable&&(v=Math.floor(f/this.pagesize),this.dataview.pagenum!=v&&(g=!1)),-1!=t.selectionmode.indexOf("cell")&&g&&(t.clearselection(),t.selectcell(h,d),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(f,d)},10))),!p)return null!=this.editcell&&(t.endcelledit(h,d,!1),this._renderrows(this.virtualsizeinfo)),!0;if(t.pageable){var v=Math.floor(f/this.pagesize);if(this.dataview.pagenum!=v)return this._renderrows(this.virtualsizeinfo),-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(m,u),t._oldselectedcell=t.selectedcell),void(v>this.dataview.pagenum&&setTimeout(function(){t.pagerpageinput.focus()},25))}t.begincelledit(h,d),null!=this.editcell&&"checkbox"==this.editcell.columntype&&this._renderrows(this.virtualsizeinfo)}return!1}if(13==s)return(a=this.selectedcell)&&(o=this.getrowvisibleindex(a.rowindex)),this.endcelledit(this.editcell.row,this.editcell.column,!1,!0),"multiplecellsadvanced"==this.selectionmode&&null!=(D=t.getselectedcell())&&t.selectcell&&null==this.editcell&&D.rowindex+1<this.dataview.totalrecords&&(this.sortcolumn!=D.datafield?(f=this.getrowvisibleindex(D.rowindex),(b=this.dataview.loadedrecords[f+1])&&(!this.pageable||this.pageable&&f+1<(this.dataview.pagenum+1)*this.pagesize)&&(this.clearselection(!1),this.selectcell(this.getboundindex(b),D.datafield),D=this.getselectedcell(),this.ensurecellvisible(b.visibleindex,D.datafield))):null!=a&&(x=this.dataview.loadedrecords[o+1])&&(!this.pageable||this.pageable&&o+1<this.pagesize?(this.clearselection(!1),this.selectcell(this.getboundindex(x),D.datafield)):this.pageable&&o+1>=this.pagesize&&(this.clearselection(!1),x=this.dataview.loadedrecords[o],this.selectcell(this.getboundindex(x),D.datafield)))),!1;if(27==s)return this.endcelledit(this.editcell.row,this.editcell.column,!0,!0),!1}else{var w=113==s?!0:!1;if(!e.ctrlKey&&!e.altKey&&!e.metaKey){48<=s&&s<=57&&(this.editchar=String.fromCharCode(s),w=!0),189===s&&(w=!0),65<=s&&s<=90?(this.editchar=String.fromCharCode(s),g=!1,e.shiftKey?g=e.shiftKey:e.modifiers&&(g=!!(4&e.modifiers)),(g=this._capsLock?!g:g)||(this.editchar=this.editchar.toLowerCase()),w=!0):96<=s&&s<=105&&(this.editchar=s-96,this.editchar=this.editchar.toString(),w=!0);var g,p=T(".jqx-grid").length,w=w&&(1==p||1<p&&t.focused),m=T.data(document.body,"jqxgrid.edit");if(void 0!==m&&""!==m&&(13===s||w)&&m!=t.element.id)return!0}if((13==s||w)&&t.getselectedrowindex){var b,h=t.getselectedrowindex();if("selectedrow"===t.editmode){if(!(0<=h))return null!=(D=t.getselectedcell())&&(r=t._getcolumnbydatafield(D.datafield),t.beginrowedit(D.rowindex)),!1;t.beginrowedit(h)}switch(t.selectionmode){case"singlerow":case"multiplerows":case"multiplerowsextended":if(0<=h){for(var d="",y=0;y<t.columns.records.length;y++)if((r=t.getcolumnat(y)).editable){d=r.datafield;break}"selectedrow"===t.editmode?t.beginrowedit(h):t.begincelledit(h,d)}break;case"singlecell":case"multiplecells":case"multiplecellsextended":null!=(D=t.getselectedcell())&&(r=t._getcolumnbydatafield(D.datafield),"selectedrow"===t.editmode?t.beginrowedit(D.rowindex):"checkbox"!=r.columntype&&t.begincelledit(D.rowindex,D.datafield));break;case"multiplecellsadvanced":null!=(D=t.getselectedcell())&&(13==s?t.selectcell&&(f=this.getrowvisibleindex(D.rowindex))+1<t.dataview.totalrecords&&(b=this.dataview.loadedrecords[f+1])&&(this.clearselection(!1),this.selectcell(this.getboundindex(b),D.datafield),D=this.getselectedcell(),this.ensurecellvisible(b.visibleindex,D.datafield)):"selectedrow"!==t.editmode&&t.begincelledit(D.rowindex,D.datafield,null,!1))}return!1}if(46==s){var _=t.getselectedcells();if(null!=(_=-1==t.selectionmode.indexOf("cell")&&t._getcellsforcopypaste?t._getcellsforcopypaste():_)&&0<_.length){for(var q=0;q<_.length;q++)if((D=_[q]).datafield){var r=t.getcolumn(D.datafield),j=t.getcellvalue(D.rowindex,D.datafield);if(""!==j&&r.editable&&t.enablekeyboarddelete){var I=null;if("checkbox"!=r.columntype||r.threestatecheckbox||(I=!1),r.cellbeginedit)if(0==r.cellbeginedit(D.rowindex,r.datafield,r.columntype,I))return!1;c=t.getrowdata(D.rowindex);t._raiseEvent(17,{rowindex:D.rowindex,row:c,datafield:D.datafield,value:j}),t.pushToHistory=!0,q==_.length-1?t.setcellvalue(D.rowindex,D.datafield,I,!0):t.setcellvalue(D.rowindex,D.datafield,I,!1),r.displayfield!=r.datafield&&t.setcellvalue(D.rowindex,r.displayfield,I,!0),t.pushToHistory=!1,r.cellendedit&&r.cellendedit(D.rowindex,r.datafield,r.columntype,I),t._raiseEvent(18,{rowindex:D.rowindex,row:c,datafield:D.datafield,oldvalue:j,value:I})}}return this.dataview.updateview(),this._renderrows(this.virtualsizeinfo),!1}}if(32==s){var D=t.getselectedcell();if(null!=D)if("checkbox"==(r=t.getcolumn(D.datafield)).columntype&&r.editable){n=!t.getcellvalue(D.rowindex,D.datafield);if(r.cellbeginedit)if(0==r.cellbeginedit(D.rowindex,r.datafield,r.columntype,!n))return!1;c=t.getrowdata(D.rowindex);return t._raiseEvent(17,{rowindex:D.rowindex,row:c,datafield:D.datafield,value:!n,columntype:"checkbox"}),t.pushToHistory=!0,t.setcellvalue(D.rowindex,D.datafield,n,!0),t.pushToHistory=!1,t._raiseEvent(18,{rowindex:D.rowindex,row:c,datafield:D.datafield,oldvalue:!n,value:n,columntype:"checkbox"}),!1}}}return!0},begincelledit:function(e,t,i,l,o){var s=this.getcolumn(t);if(this._cellscache=new Array,null!=t&&"number"!=s.columntype&&"button"!=s.columntype&&!s.createwidget){if(this.groupable){if(0<=this.groups.indexOf(t))return;if(0<=this.groups.indexOf(s.displayfield))return}if(null==this.editrow){if(this.editcell){if(this.editcell.row==e&&this.editcell.column==t)return!0;if("selectedrow"===this.editmode&&this.editcell.row==e)return;if(0==this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1))return}var d="checkbox"==s.columntype||"button"==s.columntype||s.createwidget;if(this.host.removeClass("jqx-disableselect"),this.content.removeClass("jqx-disableselect"),s.editable){if(s.cellbeginedit){var a=this.getcell(e,t);if(0==s.cellbeginedit(e,t,s.columntype,null!=a?a.value:null))return}var a=this.getrowvisibleindex(e);if(this.editcell=this.getcell(e,t),this.editcell)if(this.editcell.visiblerowindex=a,!this.editcell.editing)if(d||(this.editcell.editing=!0),this.editcell.columntype=s.columntype,this.editcell.defaultvalue=i,null!=s.defaultvalue&&(this.editcell.defaultvalue=s.defaultvalue),this.editcell.init=!0,"checkbox"!=s.columntype&&"selectedrow"!=this.editmode&&(t=this.getrowdata(e),this._raiseEvent(17,{rowindex:e,row:t,datafield:s.datafield,value:this.editcell.value,columntype:s.columntype})),T.data(document.body,"jqxgrid.edit",this.element.id),d||(a=this.getrowvisibleindex(e),!1===l||this.autorowheight||0!==this.groups.length||this.ensurecellvisible(a,s.datafield),!1!==o&&this._renderrows(this.virtualsizeinfo)),this.editcell)return!(this.editcell.init=!1)}else this.editcell?(this.editchar="",this.editcell.editor=null,(this.editcell.editing=!1)!==o&&this._renderrows(this.virtualsizeinfo),this.editcell=null):this.editchar=""}}},getScrollTop:function(){return this._py||(this._py="undefined"!=typeof pageYOffset,this._py?pageYOffset:(e=document.body,(t=(t=document.documentElement).clientHeight?t:e).scrollTop));var e,t},getScrollLeft:function(){var e,t;return"undefined"!=typeof pageXOffset?pageXOffset:(e=document.body,(t=(t=document.documentElement).clientHeight?t:e).scrollLeft)},endcelledit:function(l,o,e,s,i){if(null!=l&&null!=o||(this.editcell&&(l=this.editcell.row,o=this.editcell.column),null==e&&(e=!0)),this.editcell){var d=this.getcolumn(o),a=this;if("selectedrow"!==a.editmode){var r=function(){if(0!=i&&!a.isTouchDevice()&&!a.isNestedGrid){var e=a.getScrollTop(),t=a.getScrollLeft();try{a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e),setTimeout(function(){a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e)},10)}catch(e){}}};if("checkbox"==d.columntype||"button"==d.columntype||d.createwidget)return this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1,this.editcell=null),!0;function t(e){e._hidecelleditor(),d.cellendedit&&d.cellendedit(l,o,d.columntype,e.editcell.value,n),e.editchar=null,d.displayfield!=d.datafield&&(t=e.getcellvalue(e.editcell.row,d.displayfield)),e.editcell.value;var t,i=e.getrowdata(l);e._raiseEvent(18,{rowindex:l,row:i,datafield:o,displayfield:d.displayfield,oldvalue:n,value:n,columntype:d.columntype}),e.editcell.editor=null,e.editcell.editing=!1,e.editcell=null,!s&&null!=s||e._renderrows(e.virtualsizeinfo),r(),e.enablebrowserselection||(e.host.addClass("jqx-disableselect"),e.content.addClass("jqx-disableselect"))}var n=this._geteditorvalue(d);if(e)return t(this),!1;if(this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),!d.cellvaluechanging||null!=(c=d.cellvaluechanging(l,o,d.columntype,this.editcell.value,n))&&(n=c),d.validation){var c=this.getcell(l,o);try{var h=d.validation(c,n),u=this.gridlocalization.validationstring;if(null!=h.message&&(u=h.message),!("boolean"==typeof h?h:h.result))return null!=h.showmessage&&1!=h.showmessage||this._showvalidationpopup(l,o,u),this.editcell.validated=!1}catch(e){return this._showvalidationpopup(l,o,this.gridlocalization.validationstring),this.editcell.validated=!1}}h=d.displayfield!=d.datafield?(c=this.getcellvalue(this.editcell.row,d.displayfield),{value:this.editcell.value,label:c}):this.editcell.value;u=this.getrowdata(l);if(d.cellendedit)if(0==d.cellendedit(l,o,d.columntype,this.editcell.value,n))return this._raiseEvent(18,{rowindex:l,row:u,datafield:o,displayfield:d.displayfield,oldvalue:h,value:h,columntype:d.columntype}),t(this),!1;return this._raiseEvent(18,{rowindex:l,row:u,datafield:o,displayfield:d.displayfield,oldvalue:h,value:n,columntype:d.columntype}),this._hidecelleditor(!1),null!=this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1),this.editcell=null,this.editchar=null,this.pushToHistory=!0,this.setcellvalue(l,o,n,s),this.pushToHistory=!1,this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),T.jqx.browser.msie||r(),T.data(document.body,"jqxgrid.edit",""),!0}this.endrowedit(l,e)}},beginrowedit:function(o){var e,t,s,d=this;null!=o&&(d._oldselectedrow=o,this._cellscache=new Array,e=!1,(e="selectedrow"!=this.editmode?!0:e)&&(t=this.editmode,this.editmode="selectedrow"),s=null,this._currentEditableColumn&&(s=this.getcolumnat(this._currentEditableColumn).datafield),T.each(this.columns.records,function(e,t){if(d.editable&&this.editable){if("checkbox"===this.columntype||"custom"===this.columntype||"widget"===this.columntype||"template"===this.columntype||"button"===this.columntype)return!0;s=s||this.datafield;var i=d.getcell(o,this.datafield),l=(d.begincelledit(o,this.datafield,null,!1,!1),d.getrowdata(o));d._raiseEvent(17,{rowindex:o,row:l,datafield:this.datafield,value:i.value,columntype:this.columntype})}}),d.editcell&&(d.editcell.init=!0),this._renderrows(this.virtualsizeinfo),e&&(this.editmode=t),s&&d.editcell&&setTimeout(function(){var e;d.editcell&&d.editcell[s]&&((e=d.editcell[s].editor)&&(e.data().jqxWidget&&e.data().jqxWidget.focus?e.data().jqxWidget:e).focus())},25))},endrowedit:function(o,e){var s=this;if(this._currentEditableColumn=0,this._focusedColumn=null,this._currentColumn=null,this._checkboxCells=[],!this.editcell)return!1;if(null==this.editcell.editor&&"checkbox"!==this.editcell.columntype)return!1;this._commandColumnEdit&&(this.editmode=this._commandColumnEditMode,delete this._commandColumnEdit,delete this._commandColumnEditMode,delete this.editrow);var t,i=!1,l=((i="selectedrow"!=this.editmode?!0:i)&&(t=this.editmode,this.editmode="selectedrow"),!1),d={};this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide());for(var a=0;a<this.columns.records.length;a++){var r=this.columns.records[a];if(r.editable&&(!r.hidden&&!r.createwidget)){var n=this._geteditorvalue(r);if("checkbox"==r.columntype)e&&(n=this.editcell[r.datafield],g=this.getcellvalue(this.editcell.row,r.displayfield),this.setcellvalue(this.editcell.row,r.displayfield,n));else{var c=function(e){e._hidecelleditor();var t=e.getcellvalue(e.editcell.row,r.displayfield),i=(r.cellendedit&&r.cellendedit(o,u,r.columntype,t,n),e.editchar=null,r.displayfield!=r.datafield&&e.getcellvalue(e.editcell.row,r.displayfield),e.getrowdata(o));e._raiseEvent(18,{rowindex:o,row:i,datafield:u,displayfield:r.displayfield,oldvalue:t,value:t,columntype:r.columntype}),e.editcell.editing=!1};if(e)c(this);else{r.cellvaluechanging&&(g=this.getcellvalue(this.editcell.row,r.displayfield),null!=(p=r.cellvaluechanging(o,u,r.columntype,g,n))&&(n=p));var h,u=r.datafield;if(r.validation){var p=this.getcell(o,r.datafield);try{var f=r.validation(p,n),m=this.gridlocalization.validationstring;if(null!=f.message&&(m=f.message),!(y="boolean"==typeof f?f:f.result)){null!=f.showmessage&&1!=f.showmessage||this._showvalidationpopup(o,u,m),l=!0,this.editcell[r.datafield].validated=!1;continue}}catch(e){this._showvalidationpopup(o,u,this.gridlocalization.validationstring),l=!(this.editcell[r.datafield].validated=!1);continue}}g=r.displayfield!=r.datafield?(h=this.getcellvalue(this.editcell.row,r.displayfield),{value:this.editcell.value,label:h}):this.getcellvalue(this.editcell.row,r.displayfield),d[r.datafield]={newvalue:n,oldvalue:g}}}}}var x={},v={};if(!l){this._hidecelleditor(!1);for(a=0;a<this.columns.records.length;a++){u=(r=this.columns.records[a]).datafield;if(!r.hidden&&r.editable){var w=this.getrowdata(o);if(!r.createwidget)if("checkbox"==r.columntype){n=this.getcellvalue(o,r.displayfield);this._raiseEvent(18,{rowindex:o,row:w,datafield:r.datafield,displayfield:r.displayfield,oldvalue:n,value:n,columntype:r.columntype})}else if(d[r.datafield]){var n=d[r.datafield].newvalue,g=d[r.datafield].oldvalue;if(r.cellendedit)if(0==r.cellendedit(o,u,r.columntype,g,n)){this._raiseEvent(18,{rowindex:o,row:w,datafield:u,displayfield:r.displayfield,oldvalue:g,value:g,columntype:r.columntype}),c(this);continue}this.source.updaterow||this._raiseEvent(18,{rowindex:o,row:w,datafield:r.datafield,displayfield:r.displayfield,oldvalue:g,value:n,columntype:r.columntype}),x[r.datafield]=n,v[r.datafield]=g}}}var b=this.getrowid(o),w=this.getrowdata(o);if(T.each(x,function(e,t){var i;t&&null!=t.label?(i=s.getcolumn(e),w[i.displayfield]=t.label,w[i.datafield]=t.value):w[e]=t}),this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),T.data(document.body,"jqxgrid.edit",""),this.editcell=null,this.editchar=null,this.pushToHistory=!0,this.source.updaterow&&!e){var s=this,y=function(e){var t=s.source.updaterow;s.source.updaterow=null,0==e&&T.each(v,function(e,t){var i;t&&null!=t.label?(i=s.getcolumn(e),w[i.displayfield]=t.label,w[i.datafield]=t.value):w[e]=t}),s.updaterow(b,w);for(var i=0;i<s.columns.records.length;i++){var l=s.columns.records[i];l.datafield;s._raiseEvent(18,{rowindex:o,datafield:l.datafield,row:w,displayfield:l.displayfield,oldvalue:v[l.datafield],value:w[l.displayfield],columntype:l.columntype})}s.source.updaterow=t};try{null==this.source.updaterow(b,w,y)&&0}catch(e){return void 0}}else e||this.updaterow(b,w),this._renderrows(this.virtualsizeinfo)}return this.pushToHistory=!1,i&&(this.editmode=t),l},_selection:function(e){if("selectionStart"in e[0])return l=(i=e[0]).selectionEnd-i.selectionStart,{start:i.selectionStart,end:i.selectionEnd,length:l,text:i.value};var t=document.selection.createRange();if(null==t)return{start:0,end:i.value.length,length:0};var i=e[0].createTextRange(),e=i.duplicate(),l=(i.moveToBookmark(t.getBookmark()),e.setEndPoint("EndToStart",i),t.text.length);return{start:e.text.length,end:e.text.length+t.text.length,length:l,text:t.text}},_setSelection:function(e,t,i){try{var l;"selectionStart"in e?e.setSelectionRange(t,i):((l=e.createTextRange()).collapse(!0),l.moveEnd("character",i),l.moveStart("character",t),l.select())}catch(e){}},findRecordIndex:function(e,t,i){if(t)for(var l=i.length,o=0;o<l;o++)if(e==i[o].label)return o;return-1},_destroyeditors:function(){var d=this;this.columns.records&&(T.each(this.columns.records,function(e,t){var i=T.trim(this.datafield).split(" ").join("");switch(this.columntype){case"dropdownlist":var l=d.editors["dropdownlist_"+i];l&&(l.jqxDropDownList("destroy"),d.editors["dropdownlist_"+i]=null);break;case"combobox":l=d.editors["combobox_"+i];l&&(l.jqxComboBox("destroy"),d.editors["combobox_"+i]=null);break;case"datetimeinput":l=d.editors["datetimeinput_"+this.datafield];l&&(l.jqxDateTimeInput("destroy"),d.editors["datetimeinput_"+i]=null);break;case"numberinput":l=d.editors["numberinput_"+i];l&&(l.jqxNumberInput("destroy"),d.editors["numberinput_"+i]=null);break;case"custom":case"template":if(d.destroyeditor&&d.editors["templateeditor_"+i]&&(d.destroyeditor(d.editors["templateeditor_"+i]),d.editors["templateeditor_"+i]=null),d.destroyeditor)for(var o=d.getrows.length(),s=0;s<o;s++)d.editors["customeditor_"+i+"_"+s]&&(d.destroyeditor(d.editors["customeditor_"+i+"_"+s],s),d.editors["customeditor_"+i+"_"+s]=null);break;default:l=d.editors["textboxeditor_"+i];l&&(d.removeHandler(l,"keydown"),d.editors["textbox_"+i]=null)}}),d.editors=new Array)},_showcelleditor:function(e,d,t,i,l){if(null!=t&&null!=this.editcell)if("checkbox"==d.columntype&&d.editable)"selectedrow"==this.editmode&&(this._checkboxCells||(this._checkboxCells=[]),this._checkboxCells[d.datafield]=t);else{null==l&&(l=!0),"selectedrow"==this.editmode&&(this.editchar="",l=!1);function o(e){c.hScrollInstance.isScrolling()||c.vScrollInstance.isScrolling()||!l||c.isTouchDevice()||(e&&e.focus(),0!=c.gridcontent[0].scrollTop&&(c.scrolltop(Math.abs(c.gridcontent[0].scrollTop)),c.gridcontent[0].scrollTop=0),0!=c.gridcontent[0].scrollLeft&&(c.gridcontent[0].scrollLeft=0))}var s,a,r=d.datafield,n=T(t),c=this,h=this.editcell.editor,u=this.getcellvalue(e,r),p=this.getcelltext(e,r),f=this.hScrollInstance.value,m=parseInt(f);this.columns.records.indexOf(d),this.editcell.element=t,0==this.editcell.validated&&(f="",this.validationpopup&&(f=this.validationpopup.text()),this._showvalidationpopup(e,r,f));switch(d.columntype){case"dropdownlist":if(this.host.jqxDropDownList){t.innerHTML="";var x=T.trim(d.datafield).split(" ").join(""),v=T.trim(d.displayfield).split(" ").join(""),w=(-1!=x.indexOf(".")&&(x=x.replace(".","")),-1!=v.indexOf(".")&&(v=v.replace(".","")),"fluent"===c.theme?2:0),g=this.editors["dropdownlist_"+x],g=((h=null==g?T("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='dropdownlisteditor'></div>"):g).css("top",w+T(t).parent().position().top),this.oldhscroll?h.css("left",w-m+parseInt(T(t).position().left)):h.css("left",w+parseInt(T(t).position().left)),d.pinned&&h.css("left",w+m+parseInt(T(t).position().left)),null==g&&(h.prependTo(this.table),h[0].id="dropdownlisteditor"+this.element.id+x,q=null,q=!!this.source._source?(y={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new T.jqx.dataAdapter(y,{autoBind:!1,async:!1,uniqueDataFields:[v],autoSort:!0,autoSortField:v})):new T.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[v],async:!1,autoSort:!0,autoSortField:v}),D=!d.createeditor,h.jqxDropDownList({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:q,rtl:this.rtl,autoDropDownHeight:D,theme:this.theme,width:n.width()-w,height:n.height()-w,displayMember:v,valueMember:r}),this.editors["dropdownlist_"+x]=h,d.createeditor&&d.createeditor(e,u,h)),d._requirewidthupdate&&h.jqxDropDownList({width:n.width()}),h.jqxDropDownList("listBox").visibleItems),u=(d.createeditor||(g.length<8?h.jqxDropDownList("autoDropDownHeight",!0):h.jqxDropDownList("autoDropDownHeight",!1)),this.getcellvalue(e,v)),b=this.findRecordIndex(u,v,g);if(i&&(""!=u?h.jqxDropDownList("selectIndex",b,!0):h.jqxDropDownList("selectIndex",-1)),!this.editcell)return;null!=this.editcell.defaultvalue&&h.jqxDropDownList("selectIndex",this.editcell.defaultvalue,!0),l&&h.jqxDropDownList("focus")}break;case"combobox":if(this.host.jqxComboBox){t.innerHTML="";var y,x=T.trim(d.datafield).split(" ").join(""),v=T.trim(d.displayfield).split(" ").join(""),w=(-1!=x.indexOf(".")&&(x=x.replace(".","")),-1!=v.indexOf(".")&&(v=v.replace(".","")),"fluent"===c.theme?2:0),_=this.editors["combobox_"+x],g=((h=null==_?T("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='comboboxeditor'></div>"):_).css("top",w+T(t).parent().position().top),this.oldhscroll?h.css("left",-m+w+parseInt(T(t).position().left)):h.css("left",w+parseInt(T(t).position().left)),d.pinned&&h.css("left",w+m+parseInt(T(t).position().left)),null==_&&(h.prependTo(this.table),h[0].id="comboboxeditor"+this.element.id+x,q=null,q=!!this.source._source?(y={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new T.jqx.dataAdapter(y,{autoBind:!1,async:!1,uniqueDataFields:[v],autoSort:!0,autoSortField:v})):new T.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[v],async:!1,autoSort:!0,autoSortField:v}),D=!d.createeditor,h.jqxComboBox({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:q,rtl:this.rtl,autoDropDownHeight:D,theme:this.theme,width:n.width()-w,height:n.height()-w,displayMember:v,valueMember:r}),h.removeAttr("tabindex"),h.find("div").removeAttr("tabindex"),this.editors["combobox_"+x]=h,d.createeditor&&d.createeditor(e,u,h)),d._requirewidthupdate&&h.jqxComboBox({width:n.width()-2}),h.jqxComboBox("listBox").visibleItems),u=(d.createeditor||(g.length<8?h.jqxComboBox("autoDropDownHeight",!0):h.jqxComboBox("autoDropDownHeight",!1)),this.getcellvalue(e,v)),b=this.findRecordIndex(u,v,g);if(i&&(""!=u?h.jqxComboBox("selectIndex",b,!0):h.jqxComboBox("selectIndex",-1),h.jqxComboBox("val",u)),!this.editcell)return;null!=this.editcell.defaultvalue&&h.jqxComboBox("selectIndex",this.editcell.defaultvalue,!0),this.editchar&&0<this.editchar.length&&h.jqxComboBox("input").val(this.editchar),l&&setTimeout(function(){var e;o(h.jqxComboBox("input")),h&&(h.jqxComboBox("_setSelection",0,0),c.editchar?(h.jqxComboBox("_setSelection",1,1),c.editchar=null):h.jqxComboBox("input")&&(e=h.jqxComboBox("input").val(),h.jqxComboBox("_setSelection",0,e.length)))},10)}break;case"datetimeinput":this.host.jqxDateTimeInput&&(t.innerHTML="",-1!=(x=T.trim(d.datafield).split(" ").join("")).indexOf(".")&&(x=x.replace(".","")),w="fluent"===c.theme?2:0,_=this.editors["datetimeinput_"+x],(h=null==_?T("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='datetimeeditor'></div>"):_).show(),h.css("top",w+T(t).parent().position().top),this.oldhscroll?h.css("left",w-m+parseInt(T(t).position().left)):h.css("left",w+parseInt(T(t).position().left)),d.pinned&&h.css("left",w+m+parseInt(T(t).position().left)),null==_&&(h.prependTo(this.table),h[0].id="datetimeeditor"+this.element.id+x,y={calendar:this.gridlocalization},h.jqxDateTimeInput({hint:!1,firstDayOfWeek:this.gridlocalization.firstDay,enableBrowserBoundsDetection:!0,localization:y,_editor:!0,theme:this.theme,rtl:this.rtl,width:n.width()-w,height:n.height()-4*w,formatString:d.cellsformat}),this.editors["datetimeinput_"+x]=h,d.createeditor&&d.createeditor(e,u,h)),d._requirewidthupdate&&h.jqxDateTimeInput({width:n.width()}),i&&(""!=u&&null!=u?("Invalid Date"==(q=new Date(u))&&this.source.getvaluebytype&&(q=this.source.getvaluebytype(u,{name:d.datafield,type:"date"})),h.jqxDateTimeInput("setDate",q)):h.jqxDateTimeInput("setDate",null),null!=this.editcell.defaultvalue&&h.jqxDateTimeInput("setDate",this.editcell.defaultvalue)),l&&(s=this.editEvent,setTimeout(function(){o(h.jqxDateTimeInput("dateTimeInput")),setTimeout(function(){var e;h.jqxDateTimeInput("_selectGroup",0),c.editchar&&0<c.editchar.length&&(e=parseInt(c.editchar),isNaN(e)||s&&(e=s.charCode||s.keyCode||0,h.jqxDateTimeInput("_handleKeyPress",s,e)))},25)},10)));break;case"numberinput":this.host.jqxNumberInput&&(t.innerHTML="",-1!=(x=T.trim(d.datafield).split(" ").join("")).indexOf(".")&&(x=x.replace(".","")),w="fluent"===c.theme?2:0,D=this.editors["numberinput_"+x],(h=null==D?T("<div style='border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='numbereditor'></div>"):D).show(),h.css("top",w+T(t).parent().position().top),this.oldhscroll?h.css("left",w-m+parseInt(T(t).position().left)):h.css("left",w+parseInt(T(t).position().left)),d.pinned&&h.css("left",w+m+parseInt(T(t).position().left)),null==D&&(h.prependTo(this.table),h[0].id="numbereditor"+this.element.id+x,v="",g="left",b=2,d.cellsformat?-1!=d.cellsformat.indexOf("c")?(v=this.gridlocalization.currencysymbol,g="before"==(g=this.gridlocalization.currencysymbolposition)?"left":"right",1<d.cellsformat.length&&(b=parseInt(d.cellsformat.substring(1),10))):-1!=d.cellsformat.indexOf("p")&&(v=this.gridlocalization.percentsymbol,g="right",1<d.cellsformat.length&&(b=parseInt(d.cellsformat.substring(1),10))):b=0,h.jqxNumberInput({decimalSeparator:this.gridlocalization.decimalseparator,decimalDigits:b,inputMode:"simple",theme:this.theme,rtl:this.rtl,width:n.width()-w,height:n.height()-w,spinButtons:!0,symbol:v,symbolPosition:g}),this.editors["numberinput_"+x]=h,d.createeditor&&d.createeditor(e,u,h)),d._requirewidthupdate&&h.jqxNumberInput({width:n.width()}),i&&(""!=u&&null!=u?(a=u,h.jqxNumberInput("setDecimal",a)):h.jqxNumberInput("setDecimal",0),null!=this.editcell.defaultvalue&&h.jqxNumberInput("setDecimal",this.editcell.defaultvalue),this.editchar&&0<this.editchar.length&&(_=parseInt(this.editchar),isNaN(_)||h.jqxNumberInput("setDecimal",_)),l&&setTimeout(function(){var e;o(h.jqxNumberInput("numberInput")),h.jqxNumberInput("_setSelectionStart",0),c.editchar?(0<d.cellsformat.length&&0<=d.cellsformat.indexOf("c")?h.jqxNumberInput("_setSelectionStart",2):h.jqxNumberInput("_setSelectionStart",1),c.editchar=null):(h.jqxNumberInput("spinButtons")?(e=h.jqxNumberInput("numberInput").val(),c._setSelection(h.jqxNumberInput("numberInput")[0],e.length,e.length)):(e=h.jqxNumberInput("numberInput").val(),c._setSelection(h.jqxNumberInput("numberInput")[0],0,e.length)),h.jqxNumberInput("selectAll"))},10)));break;case"rating":this.host.jqxRating&&(t.innerHTML="",-1!=(x=T.trim(d.datafield).split(" ").join("")).indexOf(".")&&(x=x.replace(".","")),y=this.editors["rating_"+x],(h=null==y?T("<div style='margin: 5px;white-space: nowrap; overflow: auto; border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='ratingEditor'></div>"):y).show(),h.css("top",T(t).parent().position().top),this.oldhscroll?h.css("left",-m+parseInt(T(t).position().left)):h.css("left",parseInt(T(t).position().left)),d.pinned&&h.css("left",m+parseInt(T(t).position().left)),null==y&&(h.prependTo(this.table),h[0].id="ratingEditor"+this.element.id+x,h.jqxRating({theme:this.theme,width:n.width(),height:n.height()}),this.editors["numberinput_"+x]=h,d.createeditor&&d.createeditor(e,u,h)),d._requirewidthupdate&&h.jqxRating({width:n.width()}),i&&(""!=u&&null!=u?(a=u,h.jqxRating("val",a)):h.jqxRating("val",0),null!=this.editcell.defaultvalue&&h.jqxRating("val",this.editcell.defaultvalue)));break;case"custom":t.innerHTML="";-1!=(x=T.trim(d.datafield).split(" ").join("")).indexOf(".")&&(x=x.replace(".",""));var q=this.editors["customeditor_"+x+"_"+e];(h=null==q?T("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='customeditor'></div>"):q).show(),h.css("top",T(t).parent().position().top),this.oldhscroll?h.css("left",-m+parseInt(T(t).position().left)):h.css("left",parseInt(T(t).position().left)),d.pinned&&h.css("left",m+parseInt(T(t).position().left)),null==q&&(h.prependTo(this.table),h[0].id="customeditor"+this.element.id+x+"_"+e,this.editors["customeditor_"+x+"_"+e]=h,j=n.width()-1,I=n.height()-1,h.width(j),h.height(I),d.createeditor&&d.createeditor(e,u,h,p,j,I,this.editchar)),d._requirewidthupdate&&h.width(n.width());break;case"template":t.innerHTML="";-1!=(x=T.trim(d.datafield).split(" ").join("")).indexOf(".")&&(x=x.replace(".",""));var j,I,D=this.editors["templateeditor_"+x];(h=null==D?T("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='templateeditor'></div>"):D).show(),h.css("top",T(t).parent().position().top),this.oldhscroll?h.css("left",-m+parseInt(T(t).position().left)):h.css("left",parseInt(T(t).position().left)),d.pinned&&h.css("left",m+parseInt(T(t).position().left)),null==D&&(h.prependTo(this.table),h[0].id="templateeditor"+this.element.id+x,this.editors["templateeditor_"+x]=h,j=n.width()-1,I=n.height()-1,h.width(j),h.height(I),d.createeditor&&d.createeditor(e,u,h,p,j,I,this.editchar)),d._requirewidthupdate&&h.width(n.width());break;default:t.innerHTML="",(h=this.editors["textboxeditor_"+d.datafield]||T("<input autocomplete='off' style='padding-left: 4px; padding-right:4px; border: none; border-color: transparent;' autocorrect='off' autocapitalize='off' spellcheck='false' type='textbox' id='textboxeditor'/>"))[0].id="textboxeditor"+this.element.id+d.datafield,h.appendTo(n),this.rtl&&h.css("direction","rtl"),!i&&""!=h[0].className||(h.addClass(this.toThemeProperty("jqx-input")),h.addClass(this.toThemeProperty("jqx-widget-content")),this.editchar&&0<this.editchar.length?h.val(this.editchar):(""!=d.cellsformat&&(u=this.getcelltext(e,r)),h.val(u=null==u?"":u)),null!=this.editcell.defaultvalue&&h.val(this.editcell.defaultvalue),h.width(n.width()+1),h.height(n.height()+1),d.createeditor&&d.createeditor(e,u,h),""==d.cellsformat||-1==d.cellsformat.indexOf("p")&&-1==d.cellsformat.indexOf("c")&&-1==d.cellsformat.indexOf("n")&&-1==d.cellsformat.indexOf("f")||this.editors["textboxeditor_"+d.datafield]||h.keydown(function(e){e=e.charCode||e.keyCode||0,e=String.fromCharCode(e),e=parseInt(e);if(isNaN(e))return!0;if(0<c._selection(h).length)return!0;var t,i="",l=h.val();if(1<d.cellsformat.length?(t=parseInt(d.cellsformat.substring(1)),isNaN(t)&&(t=0)):t=0,0<t&&-1!=l.indexOf(c.gridlocalization.decimalseparator)&&c._selection(h).start>l.indexOf(c.gridlocalization.decimalseparator))return!0;for(var o=0;o<l.length-t;o++){var s=l.substring(o,o+1);null!=s.match(/^[0-9]+$/)&&(i+=s)}return!(11<=i.length)&&void 0})),this.editors["textboxeditor_"+d.datafield]=h,i&&l&&setTimeout(function(){o(h),c.editchar?(c._setSelection(h[0],1,1),c.editchar=null):c._setSelection(h[0],0,h.val().length)},25)}h&&(h.addClass("jqx-grid-cell-edit"),h[0].style.zIndex=1+parseInt(t.style.zIndex),T.jqx.browser.msie&&T.jqx.browser.version<8&&(h[0].style.zIndex=1+this.columns.records.length+t.style.zIndex),h.css("display","block"),this.editcell.editor=h,this.editcell[r]||(this.editcell[r]={}),this.editcell[r].editor=h),i&&d.initeditor&&d.initeditor(e,u,h,p,this.editchar),c.isTouchDevice()||setTimeout(function(){c.content&&(c.content[0].scrollTop=0,c.content[0].scrollLeft=0),c.gridcontent&&(c.gridcontent[0].scrollLeft=0,c.gridcontent[0].scrollTop=0)},10)}},_hideeditors:function(){if(null!=this.editcells)for(var e in this.editcells)this.editcell=this.editcells[e],this._hidecelleditor()},_hidecelleditor:function(e){if(this.editcell)if("selectedrow"===this.editmode){for(var t=0;t<this.columns.records.length;t++){var i=this.columns.records[t];if(this.editcell[i.datafield]&&this.editcell[i.datafield].editor){this.editcell[i.datafield].editor.hide();var l=this.editcell[i.datafield].editor;switch(i.columntype){case"dropdownlist":l.jqxDropDownList({closeDelay:0}),l.jqxDropDownList("hideListBox"),l.jqxDropDownList({closeDelay:300});break;case"combobox":l.jqxComboBox({closeDelay:0}),l.jqxComboBox("hideListBox"),l.jqxComboBox({closeDelay:300});break;case"datetimeinput":l.jqxDateTimeInput("isOpened")&&(l.jqxDateTimeInput({closeDelay:0}),l.jqxDateTimeInput("hideCalendar"),l.jqxDateTimeInput({closeDelay:300}))}}}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide())}else if("checkbox"!=this.editcell.columntype){if(this.editcell.editor)switch(this.editcell.editor.hide(),this.editcell.columntype){case"dropdownlist":this.editcell.editor.jqxDropDownList({closeDelay:0}),this.editcell.editor.jqxDropDownList("hideListBox"),this.editcell.editor.jqxDropDownList({closeDelay:300});break;case"combobox":this.editcell.editor.jqxComboBox({closeDelay:0}),this.editcell.editor.jqxComboBox("hideListBox"),this.editcell.editor.jqxComboBox({closeDelay:300});break;case"datetimeinput":var o=this.editcell.editor;o.jqxDateTimeInput("isOpened")&&(o.jqxDateTimeInput({closeDelay:0}),o.jqxDateTimeInput("hideCalendar"),o.jqxDateTimeInput({closeDelay:300}))}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),this.isNestedGrid||0!=e&&this.element.focus()}},_geteditorvalue:function(e){var t=new String;if(!this.editcell)return null;var i,l=this.editcell.editor;if(l="selectedrow"==this.editmode&&this.editcell[e.datafield]?this.editcell[e.datafield].editor:l){switch(e.columntype){case"textbox":default:if(t=l.val(),""!=e.cellsformat){var o,s="string",d=this.source.datafields||(this.source._source?this.source._source.datafields:null),d=(d&&(o="",T.each(d,function(){if(this.name==e.displayfield)return this.type&&(o=this.type),!1}),o&&(s=o)),"number"===s||"float"===s||"int"===s||"integer"===s),a="date"===s||"time"===s;if(d||"string"===s&&(-1!=e.cellsformat.indexOf("p")||-1!=e.cellsformat.indexOf("c")||-1!=e.cellsformat.indexOf("n")||-1!=e.cellsformat.indexOf("f"))){if(""===t&&e.nullable)return"";t=t.indexOf&&-1<t.indexOf(this.gridlocalization.currencysymbol)?t.replace(this.gridlocalization.currencysymbol,""):t;d=new Number(t);if(!isNaN(d))return d;-1<(t=(t=function(e,t,i){var l=e;if(t==i)return e;for(var o=l.indexOf(t);-1!=o;)o=(l=l.replace(t,i)).indexOf(t);return l}(t,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(t=t.replace(this.gridlocalization.percentsymbol,""));for(var r="",n=0;n<t.length;n++){var c=t.substring(n,n+1);"-"===c&&(r+="-"),"."===c&&(r+="."),null!=c.match(/^[0-9]+$/)&&(r+=c)}t=(t=r).replace(/ /g,""),t=new Number(t),isNaN(t)&&(t="")}if(a||"string"===s&&(-1!=e.cellsformat.indexOf("H")||-1!=e.cellsformat.indexOf("m")||-1!=e.cellsformat.indexOf("M")||-1!=e.cellsformat.indexOf("y")||-1!=e.cellsformat.indexOf("h")||-1!=e.cellsformat.indexOf("d"))){if(""===t&&e.nullable)return"";d=t;"Invalid Date"!=(t=T.jqx.dataFormat?T.jqx.dataFormat.tryparsedate(d,this.gridlocalization):t)&&null!=t||(t="")}}e.displayfield!=e.datafield&&(t={label:t,value:t});break;case"checkbox":l.jqxCheckBox&&(t=l.jqxCheckBox("checked"));break;case"datetimeinput":if(l.jqxDateTimeInput){if(l.jqxDateTimeInput({isEditing:!1}),"none"!==l.jqxDateTimeInput("container").css("display")&&l.jqxDateTimeInput("close"),l.jqxDateTimeInput("_validateValue"),null==(t=l.jqxDateTimeInput("getDate")))return null;t=new Date(t.toString()),e.displayfield!=e.datafield&&(t={label:t,value:t})}break;case"dropdownlist":l.jqxDropDownList&&(a=l.jqxDropDownList("selectedIndex"),i=l.jqxDropDownList("listBox").getVisibleItem(a),null==(t=e.displayfield!=e.datafield?i?{label:i.label,value:i.value}:"":i?i.label:"")&&(t=""));break;case"combobox":l.jqxComboBox&&(t=l.jqxComboBox("val"),null==(t=e.displayfield!=e.datafield&&null!=(i=l.jqxComboBox("getSelectedItem"))?{label:i.label,value:i.value}:t)&&(t=""));break;case"numberinput":l.jqxNumberInput&&(this.touchdevice&&l.jqxNumberInput("_doTouchHandling"),s=l.jqxNumberInput("getDecimal"),t=new Number(s),t=parseFloat(t),isNaN(t)&&(t=0),null===s&&(t=null),d=l.jqxNumberInput("max"),a=l.jqxNumberInput("min"),t=Math.min(d,Math.max(a,t)),e.displayfield!=e.datafield&&(t={label:t,value:t}))}e.geteditorvalue&&(t="selectedrow"==this.editmode?e.geteditorvalue(this.editcell.row,this.getcellvalue(this.editcell.row,e.datafield),l):e.geteditorvalue(this.editcell.row,this.editcell.value,l))}return t},hidevalidationpopups:function(){this.popups&&(T.each(this.popups,function(){this.validation.remove(),this.validationrow.remove()}),this.popups=new Array),this.validationpopup&&(this.validationpopuparrow.hide(),this.validationpopup.hide())},showvalidationpopup:function(i,l,o){null==o&&(o=this.gridlocalization.validationstring);var e=T("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),t=T("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>");e.html(o),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),e.addClass(this.toThemeProperty("jqx-grid-validation")),e.addClass(this.toThemeProperty("jqx-rc-all")),e.prependTo(this.table),t.prependTo(this.table);for(var s,d=this.hScrollInstance.value,d=parseInt(d),a=this.getcolumn(l).uielement,r=null,n=0;n<this.hittestinfo.length;n++)i===this.hittestinfo[n].row.visibleindex&&(r=this.hittestinfo[n]);if(!r)return this.ensurerowvisible(i),s=this,e.remove(),t.remove(),void setTimeout(function(){for(var e=null,t=0;t<s.hittestinfo.length;t++)i===s.hittestinfo[t].row.visibleindex&&(e=s.hittestinfo[t]);e&&s.showvalidationpopup(i,l,o)},25);var c=T(r.visualrow),h=(e.css("top",parseInt(c.position().top)+30+"px"),parseInt(e.css("top"))),u=(t.css("top",h-12),t.removeClass(),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),!1),c=(h>=this._gettableheight()-this.rowsheight&&(t.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),(h=parseInt(c.position().top)-this.rowsheight)<0&&(h=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),u=!0),e.css("top",h+"px"),t.css("top",h+e.outerHeight()-9)),-d+parseInt(T(a).position().left)),h=(0===a[0].offsetHeight&&(c=-d+parseInt(a[0].style.left)),t.css("left",d+c+30),e.width());h+c>this.host.width()-20&&(c-=h+c-this.host.width()+40),u?e.css("left",d+parseInt(T(a).position().left)-e.outerWidth()):e.css("left",d+c),e.show(),t.show(),this.popups||(this.popups=new Array),this.popups[this.popups.length]={validation:e,validationrow:t}},_showvalidationpopup:function(e,t,i){var l,o=this.editcell,s=this.editcell.editor;"selectedrow"==this.editmode&&(o=this.editcell[t])&&o.editor&&(s=o.editor,o.element=s),!s||this.validationpopup&&T.jqx.isHidden(this.validationpopup)&&(this.validationpopup.remove&&(this.validationpopup.remove(),this.validationpopuparrow.remove()),this.validationpopup=null,this.validationpopuparrow=null,void 0===t&&void 0===i&&this.editors&&0===this.editors.length)||(this.validationpopup?this.validationpopup.html(i):(s=T("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),t=T("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>"),s.html(i),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),s.addClass(this.toThemeProperty("jqx-grid-validation")),s.addClass(this.toThemeProperty("jqx-rc-all")),s.prependTo(this.table),t.prependTo(this.table),this.validationpopup=s,this.validationpopuparrow=t),i=this.hScrollInstance.value,s=parseInt(i),"selectedrow"==this.editmode?this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.validationpopup.css("top",this.visiblerows[this.editcell.visiblerowindex].top+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(T(o.editor).position().top)+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(T(o.element).parent().position().top)+(this.rowsheight+5)+"px"),t=parseInt(this.validationpopup.css("top")),this.validationpopuparrow.css("top",t-11),this.validationpopuparrow.removeClass(),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),i=!1,this._gettableheight()<=t&&(this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),t=parseInt(T(o.element).parent().position().top)-this.rowsheight-5,(t="selectedrow"==this.editmode?this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.visiblerows[this.editcell.visiblerowindex].top-this.rowsheight-5:parseInt(T(o.editor).position().top)-this.rowsheight-5:t)<0&&(t=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),i=!0),this.validationpopup.css("top",t+"px"),this.validationpopuparrow.css("top",t+this.validationpopup.outerHeight()-9)),t=-s+parseInt(T(o.element).position().left),this.validationpopuparrow.css("left",s+t+30),(l=this.validationpopup.width())+t>this.host.width()-20&&(t-=l+t-this.host.width()+40),i?this.validationpopup.css("left",s+parseInt(T(o.element).position().left)-this.validationpopup.outerWidth()):this.validationpopup.css("left",s+t),"none"==this.editcell.editor.css("display")?(this.validationpopup.hide(),this.validationpopuparrow.hide()):(this.validationpopup.show(),this.validationpopuparrow.show()))}})}(jqxBaseFramework);